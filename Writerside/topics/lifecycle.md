# Цикл запроса


## Инициализация
Точкой входа в приложение является файл index.php, расположенный в корневой директории приложения.
Данный файл подгружает ядро `init_core.php`, конфигурацию приложения `app_configs.php`, библиотеки
`init_libs.php`, языки `init_langs.php` и в последнюю очередь маршрутизатор `router.php`. Таким образом
мы инициализируем все необходимые зависимости для дальнейшей обработки запроса.

## Маршрутизатор 
Задачей маршрутизатора является обработка и направление запроса. Первым этапом обработки является
формирование глобальной переменной `$requestData`, которая содержит следующие параметры:

### Параметры запроса
> \* Обязательные параметры
{style="warning"}

| Параметр  | Описание                                 |
|-----------|------------------------------------------|
| * object  | Объект с которым хотим работать          |
| * сommand | Команда, которая будет вызвана у объекта |
| data      | Тело запроса для команды                 |
| jwt       | Токен авторизации для пользователя       |

> *Название объекта и команды может содержать только символы латинского алфавита, цифры, дефис, нижнее
подчеркивание и квадратные скобки*
{style="note"}


Пример запроса в црм для получения списка посещений с пользователем под номером 120 для списка

```json
{
  "object": "visits",
  "command": "get",
  "data": {
    "context": {
      "block": "list"
    },
    "client_id": 120
  },
  "jwt": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJpZCI6MiwiaXA"
}
```

Помимо отправки JSON напрямую, router также обрабатывает данные формата `form-data` из `$_POST` преобразуя
к формату запроса выше. Отправленные файлы из `$_FILES` будут обработаны и интегрированы в тело запроса 
`data`.

После формирования запроса маршрутизатор получает схему команды и объекта в глобальные переменные 
`$commandScheme` и `$objectScheme` соответственно.


Custom

Prefix

Postfix






router.php




POST запрос



Get

Add

Update

Remove